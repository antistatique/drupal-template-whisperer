<?php

/**
 * @file
 * Contains template_whisperer.module.
 */

use Drupal\Core\Entity\ContentEntityInterface;

/**
 * Implements hook_theme_suggestions_alter().
 */
function template_whisperer_theme_suggestions_alter(array &$suggestions, array $variables, $hook) {
  if (isset($variables['elements']['#entity_type']) && $variables['elements']['#entity_type'] === $hook) {
    $twManager = \Drupal::service('plugin.manager.template_whisperer');

    $entity = NULL;
    if (isset($variables['elements']['#' . $hook])) {
      $entity = $variables['elements']['#' . $hook];
    }

    if (!empty($entity) && $entity instanceof ContentEntityInterface) {
      $suggestionsEntity = $twManager->suggestionsFromEntity($entity);

      if (!empty($suggestionsEntity)) {
        // Expose one suggestion by fields.
        foreach ($suggestionsEntity as $suggestion) {
          $suggestions[] = $entity->getEntityTypeId() . '__' . $entity->bundle() . '__' . $suggestion;
        }

        // Expose a suggestion merging each fields suggestion on this entity.
        if (count($suggestionsEntity) > 1) {
          $suggestions[] = $entity->getEntityTypeId() . '__' . $entity->bundle() . '__' . implode('__', $suggestionsEntity);
        }
      }
    }
  }
}

// Includes.
require_once 'inc/rm_cardinality.inc';
require_once 'inc/help.inc';
require_once 'inc/tokens.inc';
require_once 'inc/access.inc';